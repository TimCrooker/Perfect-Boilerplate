"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.handleIgnore = exports.concatExtend = exports.getExtend = exports.getPluginsArray = exports.extendBase = void 0;

var _deepmerge = _interopRequireDefault(require("deepmerge"));

var _path = _interopRequireDefault(require("path"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Base file structure to extend
 */
const extendBase = {
  _app: {
    import: [],
    inner: [],
    wrapper: []
  },
  _document: {
    import: [],
    initialProps: []
  }
};
/**
 * @summary Parse user answers for their desired plugins
 *
 * @param answers Dictionary of [key, value] pairs of answers all prompts
 *
 * @returns an array of selected plugins
 */

exports.extendBase = extendBase;

const getPluginsArray = answers => {
  return Object.entries(answers).reduce((acc, [key, value]) => {
    console.log(acc, key, value);
    if (typeof value === 'boolean' && value) return [...acc, key];
    if (typeof value === 'string') return [...acc, value];
    if (Array.isArray(value)) return [...acc, ...value];
    return acc;
  }, []).filter(value => value !== 'none');
};
/**
 *
 * @param pluginPath path to a plugin pack
 * @param pluginName name of the plugin from the pack to target
 * @returns object containing extend function that itself returns the extend object to merge with the template files
 */


exports.getPluginsArray = getPluginsArray;

const getExtend = (pluginPath, pluginName) => {
  try {
    // eslint-disable-next-line @typescript-eslint/no-var-requires
    const pluginExtend = require(_path.default.join(pluginPath, 'plugins', pluginName, 'extend.js'));

    return pluginExtend;
  } catch (e) {
    return undefined;
  }
};
/**
 *
 * @param base The base file structure that plugins can expand on
 * @param plugins Array of user-selected plugins to integrate
 * @param sourcePath Source directory of the selected plugin pack
 * @param answers [pluginName, answer] List of supplied user answers to all prompts
 * @returns the merged combination of the base file structure and the supplied extend.js file
 */


exports.getExtend = getExtend;

const concatExtend = (base, plugins, sourcePath, answers) => {
  // combines the extend.js file with the base file from the plugin pack template
  const merged = _deepmerge.default.all([base, ...plugins.map(plugin => {
    const pluginExtendFile = getExtend(sourcePath, plugin);

    if (pluginExtendFile) {
      const pluginExtends = pluginExtendFile.extend(answers);
      return pluginExtends;
    }

    return {};
  })]);

  return merged;
};
/**
 * 
 * @param ignores the array of ignore objects from the plugin packs prompt.js
 * @param answers answers provided by the user to all prompt questions
 * @param plugin name of the current plugin to target
 * @returns 
 */


exports.concatExtend = concatExtend;

const handleIgnore = (ignores, answers, plugin) => {
  const filters = {};
  ignores.forEach(ignore => {
    if (!!ignore.plugin === false || !!ignore.plugin && ignore.plugin.includes(plugin)) {
      var _ignore$when;

      const condition = (_ignore$when = ignore.when) === null || _ignore$when === void 0 ? void 0 : _ignore$when.call(ignore, answers);

      if (condition) {
        ignore.pattern.forEach(pattern => {
          filters[pattern] = false;
        });
      }
    }
  });
  return filters;
};

exports.handleIgnore = handleIgnore;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9VdGlscy9wbHVnaW4vaW5kZXgudHMiXSwibmFtZXMiOlsiZXh0ZW5kQmFzZSIsIl9hcHAiLCJpbXBvcnQiLCJpbm5lciIsIndyYXBwZXIiLCJfZG9jdW1lbnQiLCJpbml0aWFsUHJvcHMiLCJnZXRQbHVnaW5zQXJyYXkiLCJhbnN3ZXJzIiwiT2JqZWN0IiwiZW50cmllcyIsInJlZHVjZSIsImFjYyIsImtleSIsInZhbHVlIiwiY29uc29sZSIsImxvZyIsIkFycmF5IiwiaXNBcnJheSIsImZpbHRlciIsImdldEV4dGVuZCIsInBsdWdpblBhdGgiLCJwbHVnaW5OYW1lIiwicGx1Z2luRXh0ZW5kIiwicmVxdWlyZSIsInBhdGgiLCJqb2luIiwiZSIsInVuZGVmaW5lZCIsImNvbmNhdEV4dGVuZCIsImJhc2UiLCJwbHVnaW5zIiwic291cmNlUGF0aCIsIm1lcmdlZCIsIm1lcmdlIiwiYWxsIiwibWFwIiwicGx1Z2luIiwicGx1Z2luRXh0ZW5kRmlsZSIsInBsdWdpbkV4dGVuZHMiLCJleHRlbmQiLCJoYW5kbGVJZ25vcmUiLCJpZ25vcmVzIiwiZmlsdGVycyIsImZvckVhY2giLCJpZ25vcmUiLCJpbmNsdWRlcyIsImNvbmRpdGlvbiIsIndoZW4iLCJwYXR0ZXJuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBQ0E7Ozs7QUFHQTtBQUNBO0FBQ0E7QUFDTyxNQUFNQSxVQUFnQyxHQUFHO0FBQzlDQyxFQUFBQSxJQUFJLEVBQUU7QUFDSkMsSUFBQUEsTUFBTSxFQUFFLEVBREo7QUFFSkMsSUFBQUEsS0FBSyxFQUFFLEVBRkg7QUFHSkMsSUFBQUEsT0FBTyxFQUFFO0FBSEwsR0FEd0M7QUFNOUNDLEVBQUFBLFNBQVMsRUFBRTtBQUNUSCxJQUFBQSxNQUFNLEVBQUUsRUFEQztBQUVUSSxJQUFBQSxZQUFZLEVBQUU7QUFGTDtBQU5tQyxDQUF6QztBQVlQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FBQ08sTUFBTUMsZUFB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QUFPLENBQUNNLE9BQUQsQ0FBUCxHQUFtQixLQUFuQjtBQUNELFNBRkQ7QUFHRDtBQUNGO0FBQ0YsR0FaRDtBQWNBLFNBQU9OLE9BQVA7QUFDRCxDQXRCTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBtZXJnZSBmcm9tICdkZWVwbWVyZ2UnXHJcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnXHJcbmltcG9ydCB7IEV4dGVuZFR5cGUsIEFuc3dlciwgSWdub3JlSGFuZGxlckZuLCBJZ25vcmVUeXBlIH0gZnJvbSAnLi9wbHVnaW4nXHJcblxyXG4vKipcclxuICogQmFzZSBmaWxlIHN0cnVjdHVyZSB0byBleHRlbmRcclxuICovXHJcbmV4cG9ydCBjb25zdCBleHRlbmRCYXNlOiBSZXF1aXJlZDxFeHRlbmRUeXBlPiA9IHtcclxuICBfYXBwOiB7XHJcbiAgICBpbXBvcnQ6IFtdLFxyXG4gICAgaW5uZXI6IFtdLFxyXG4gICAgd3JhcHBlcjogW10sXHJcbiAgfSxcclxuICBfZG9jdW1lbnQ6IHtcclxuICAgIGltcG9ydDogW10sXHJcbiAgICBpbml0aWFsUHJvcHM6IFtdLFxyXG4gIH0sXHJcbn1cclxuXHJcbi8qKlxyXG4gKiBAc3VtbWFyeSBQYXJzZSB1c2VyIGFuc3dlcnMgZm9yIHRoZWlyIGRlc2lyZWQgcGx1Z2luc1xyXG4gKlxyXG4gKiBAcGFyYW0gYW5zd2VycyBEaWN0aW9uYXJ5IG9mIFtrZXksIHZhbHVlXSBwYWlycyBvZiBhbnN3ZXJzIGFsbCBwcm9tcHRzXHJcbiAqXHJcbiAqIEByZXR1cm5zIGFuIGFycmF5IG9mIHNlbGVjdGVkIHBsdWdpbnNcclxuICovXHJcbmV4cG9ydCBjb25zdCBnZXRQbHVnaW5zQXJyYXk6IChhbnN3ZXJzOiBSZWNvcmQ8c3RyaW5nLCBBbnN3ZXI+KSA9PiBzdHJpbmdbXSA9IChcclxuICBhbnN3ZXJzXHJcbikgPT4ge1xyXG4gIHJldHVybiBPYmplY3QuZW50cmllcyhhbnN3ZXJzKVxyXG4gICAgLnJlZHVjZSgoYWNjOiBzdHJpbmdbXSwgW2tleSwgdmFsdWVdKSA9PiB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGFjYywga2V5LCB2YWx1ZSlcclxuICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nICYmIHZhbHVlKSByZXR1cm4gWy4uLmFjYywga2V5XVxyXG4gICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykgcmV0dXJuIFsuLi4oYWNjIGFzIHN0cmluZ1tdKSwgdmFsdWVdXHJcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkgcmV0dXJuIFsuLi4oYWNjIGFzIHN0cmluZ1tdKSwgLi4udmFsdWVdXHJcbiAgICAgIHJldHVybiBhY2NcclxuICAgIH0sIFtdKVxyXG4gICAgLmZpbHRlcigodmFsdWU6IHN0cmluZykgPT4gdmFsdWUgIT09ICdub25lJylcclxufVxyXG5cclxuLyoqXHJcbiAqXHJcbiAqIEBwYXJhbSBwbHVnaW5QYXRoIHBhdGggdG8gYSBwbHVnaW4gcGFja1xyXG4gKiBAcGFyYW0gcGx1Z2luTmFtZSBuYW1lIG9mIHRoZSBwbHVnaW4gZnJvbSB0aGUgcGFjayB0byB0YXJnZXRcclxuICogQHJldHVybnMgb2JqZWN0IGNvbnRhaW5pbmcgZXh0ZW5kIGZ1bmN0aW9uIHRoYXQgaXRzZWxmIHJldHVybnMgdGhlIGV4dGVuZCBvYmplY3QgdG8gbWVyZ2Ugd2l0aCB0aGUgdGVtcGxhdGUgZmlsZXNcclxuICovXHJcbmV4cG9ydCBjb25zdCBnZXRFeHRlbmQ6IChcclxuICBwbHVnaW5QYXRoOiBzdHJpbmcsXHJcbiAgcGx1Z2luTmFtZTogc3RyaW5nXHJcbikgPT4geyBleHRlbmQ6IChhbnN3ZXJzOiBSZWNvcmQ8c3RyaW5nLCBBbnN3ZXI+KSA9PiBFeHRlbmRUeXBlIH0gfCB1bmRlZmluZWQgPSAoXHJcbiAgcGx1Z2luUGF0aCxcclxuICBwbHVnaW5OYW1lXHJcbikgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXZhci1yZXF1aXJlc1xyXG4gICAgY29uc3QgcGx1Z2luRXh0ZW5kID0gcmVxdWlyZShwYXRoLmpvaW4oXHJcbiAgICAgIHBsdWdpblBhdGgsXHJcbiAgICAgICdwbHVnaW5zJyxcclxuICAgICAgcGx1Z2luTmFtZSxcclxuICAgICAgJ2V4dGVuZC5qcydcclxuICAgICkpXHJcblxyXG4gICAgcmV0dXJuIHBsdWdpbkV4dGVuZFxyXG4gIH0gY2F0Y2ggKGUpIHtcclxuICAgIHJldHVybiB1bmRlZmluZWRcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKlxyXG4gKiBAcGFyYW0gYmFzZSBUaGUgYmFzZSBmaWxlIHN0cnVjdHVyZSB0aGF0IHBsdWdpbnMgY2FuIGV4cGFuZCBvblxyXG4gKiBAcGFyYW0gcGx1Z2lucyBBcnJheSBvZiB1c2VyLXNlbGVjdGVkIHBsdWdpbnMgdG8gaW50ZWdyYXRlXHJcbiAqIEBwYXJhbSBzb3VyY2VQYXRoIFNvdXJjZSBkaXJlY3Rvcnkgb2YgdGhlIHNlbGVjdGVkIHBsdWdpbiBwYWNrXHJcbiAqIEBwYXJhbSBhbnN3ZXJzIFtwbHVnaW5OYW1lLCBhbnN3ZXJdIExpc3Qgb2Ygc3VwcGxpZWQgdXNlciBhbnN3ZXJzIHRvIGFsbCBwcm9tcHRzXHJcbiAqIEByZXR1cm5zIHRoZSBtZXJnZWQgY29tYmluYXRpb24gb2YgdGhlIGJhc2UgZmlsZSBzdHJ1Y3R1cmUgYW5kIHRoZSBzdXBwbGllZCBleHRlbmQuanMgZmlsZVxyXG4gKi9cclxuZXhwb3J0IGNvbnN0IGNvbmNhdEV4dGVuZDogKFxyXG4gIGJhc2U6IEV4dGVuZFR5cGUsXHJcbiAgcGx1Z2luczogc3RyaW5nW10sXHJcbiAgc291cmNlUGF0aDogc3RyaW5nLFxyXG4gIGFuc3dlcnM6IFJlY29yZDxzdHJpbmcsIEFuc3dlcj5cclxuKSA9PiBFeHRlbmRUeXBlID0gKGJhc2UsIHBsdWdpbnMsIHNvdXJjZVBhdGgsIGFuc3dlcnMpID0+IHtcclxuICAvLyBjb21iaW5lcyB0aGUgZXh0ZW5kLmpzIGZpbGUgd2l0aCB0aGUgYmFzZSBmaWxlIGZyb20gdGhlIHBsdWdpbiBwYWNrIHRlbXBsYXRlXHJcbiAgY29uc3QgbWVyZ2VkID0gbWVyZ2UuYWxsPEV4dGVuZFR5cGU+KFtcclxuICAgIGJhc2UsXHJcbiAgICAuLi5wbHVnaW5zLm1hcCgocGx1Z2luOiBzdHJpbmcpID0+IHtcclxuICAgICAgY29uc3QgcGx1Z2luRXh0ZW5kRmlsZSA9IGdldEV4dGVuZChzb3VyY2VQYXRoLCBwbHVnaW4pXHJcbiAgICAgIGlmIChwbHVnaW5FeHRlbmRGaWxlKSB7XHJcbiAgICAgICAgY29uc3QgcGx1Z2luRXh0ZW5kcyA9IHBsdWdpbkV4dGVuZEZpbGUuZXh0ZW5kKGFuc3dlcnMpXHJcbiAgICAgICAgcmV0dXJuIHBsdWdpbkV4dGVuZHNcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4ge31cclxuICAgIH0pLFxyXG4gIF0pXHJcblxyXG4gIHJldHVybiBtZXJnZWRcclxufVxyXG5cclxuLyoqXHJcbiAqIFxyXG4gKiBAcGFyYW0gaWdub3JlcyB0aGUgYXJyYXkgb2YgaWdub3JlIG9iamVjdHMgZnJvbSB0aGUgcGx1Z2luIHBhY2tzIHByb21wdC5qc1xyXG4gKiBAcGFyYW0gYW5zd2VycyBhbnN3ZXJzIHByb3ZpZGVkIGJ5IHRoZSB1c2VyIHRvIGFsbCBwcm9tcHQgcXVlc3Rpb25zXHJcbiAqIEBwYXJhbSBwbHVnaW4gbmFtZSBvZiB0aGUgY3VycmVudCBwbHVnaW4gdG8gdGFyZ2V0XHJcbiAqIEByZXR1cm5zIFxyXG4gKi9cclxuZXhwb3J0IGNvbnN0IGhhbmRsZUlnbm9yZTogSWdub3JlSGFuZGxlckZuID0gKFxyXG4gIGlnbm9yZXM6IElnbm9yZVR5cGVbXSxcclxuICBhbnN3ZXJzLFxyXG4gIHBsdWdpblxyXG4pID0+IHtcclxuICBjb25zdCBmaWx0ZXJzOiBSZXR1cm5UeXBlPElnbm9yZUhhbmRsZXJGbj4gPSB7fVxyXG5cclxuICBpZ25vcmVzLmZvckVhY2goKGlnbm9yZSkgPT4ge1xyXG4gICAgaWYgKFxyXG4gICAgICAhIWlnbm9yZS5wbHVnaW4gPT09IGZhbHNlIHx8XHJcbiAgICAgICghIWlnbm9yZS5wbHVnaW4gJiYgaWdub3JlLnBsdWdpbi5pbmNsdWRlcyhwbHVnaW4pKVxyXG4gICAgKSB7XHJcbiAgICAgIGNvbnN0IGNvbmRpdGlvbiA9IGlnbm9yZS53aGVuPy4oYW5zd2VycylcclxuICAgICAgaWYgKGNvbmRpdGlvbikge1xyXG4gICAgICAgIGlnbm9yZS5wYXR0ZXJuLmZvckVhY2goKHBhdHRlcm4pID0+IHtcclxuICAgICAgICAgIGZpbHRlcnNbcGF0dGVybl0gPSBmYWxzZVxyXG4gICAgICAgIH0pXHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9KVxyXG5cclxuICByZXR1cm4gZmlsdGVyc1xyXG59XHJcbiJdfQ==