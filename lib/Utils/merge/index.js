"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.mergePackages = exports.mergeBabel = exports.mergePluginData = exports.mergeJSONFiles = void 0;

var _deepmerge = _interopRequireDefault(require("deepmerge"));

var _fs = require("fs");

var _path = _interopRequireDefault(require("path"));

var _util = require("util");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 *
 * @param pluginPath path to the plugin pack directory
 * @param pluginName name of the plugin to target
 * @param fileName name of the file inside of a plugin to target
 * @returns the file being targeted in the specified plugin
 */
const getPluginFile = (pluginPath, pluginName, fileName) => {
  try {
    // eslint-disable-next-line @typescript-eslint/no-var-requires
    const pluginFile = require(_path.default.join(pluginPath, 'plugins', pluginName, fileName));

    return pluginFile;
  } catch (e) {
    return undefined;
  }
};
/**
 * Stringify the contents of a file inside of the plugin provided
 *
 * @param pluginPath path to the plugin pack directory
 * @param pluginName name of the plugin to target
 * @param fileName name of the file inside of the plugin to target
 */


const getStringFile = async (pluginPath, pluginName, fileName) => {
  try {
    const str = await (0, _util.promisify)(_fs.readFile)(_path.default.join(pluginPath, 'plugins', pluginName, fileName), 'utf8');

    if (typeof str === 'string') {
      return str;
    } else {
      return '{}';
    }
  } catch (e) {
    return '{}';
  }
};
/**
 * Combine JSON files of the same type into one file using deepMerge
 *
 * @param base
 * @param pluginsPath
 * @param plugins
 * @param fileName
 * @param mergeOptions
 * @returns
 */


const mergeJSONFiles = (base = {}, pluginsPath, plugins, fileName, mergeOptions) => {
  const baseFile = { ...base
  };
  const pluginFiles = plugins.map(plugin => {
    const file = getPluginFile(pluginsPath, plugin, fileName);
    return file ?? {};
  });
  return _deepmerge.default.all([baseFile, ...pluginFiles], mergeOptions);
};
/**
 * Combine all plugin meta.json data into one document
 *
 * @param base base dictionary of plugins
 * @param pluginsPath path to the plugin pack directory
 * @param plugins array of all selected plugins
 * @param fileName target file for the plugins
 */


exports.mergeJSONFiles = mergeJSONFiles;

const mergePluginData = (base = {}, pluginsPath, plugins, fileName) => {
  const baseFile = { ...base
  };
  baseFile.plugins = [];
  plugins.map(plugin => {
    if (['npm', 'yarn', 'react', 'nextjs', 'refine'].includes(plugin)) return;
    const file = getPluginFile(pluginsPath, plugin, fileName) ?? {};
    baseFile.plugins.push({
      name: file.name ?? plugin,
      description: file.description ?? '',
      url: file.url ?? ''
    });
  });
  return baseFile;
};
/**
 * combine all .babelrc files together into one
 *
 * @param base base dictionary of plugins
 * @param pluginsPath path to the plugin pack directory
 * @param plugins array of all selected plugins
 */


exports.mergePluginData = mergePluginData;

const mergeBabel = async (base, pluginsPath, plugins) => {
  const baseBabel = { ...base
  };
  const pluginRcs = await Promise.all(plugins.map(async plugin => {
    const str = await getStringFile(pluginsPath, plugin, '.babelrc');
    const parsed = JSON.parse(str);
    return parsed ?? {};
  }));

  const merged = _deepmerge.default.all([baseBabel, ...pluginRcs]);

  const uniquePresets = [];
  const presetsSet = new Set(merged.presets ?? []);
  presetsSet.forEach(el => uniquePresets.push(el));
  merged.presets = uniquePresets;
  return merged;
};
/**
 * merge package.json and package.js files together
 *
 * @param base all of the data provided by the saoFile data function
 * @param pluginsPath
 * @param plugins
 * @param answers
 */


exports.mergeBabel = mergeBabel;

const mergePackages = (base = {}, pluginsPath, plugins, answers) => {
  const basePkg = { ...base
  };
  const pluginPkgs = plugins.map(plugin => {
    const pluginPkg = getPluginFile(pluginsPath, plugin, 'package.json');
    const pluginPkgFn = getPluginFile(pluginsPath, plugin, 'package.js');

    if (pluginPkgFn && pluginPkg) {
      const fnPkg = pluginPkgFn.apply(pluginPkg, answers);
      return fnPkg;
    } else if (pluginPkg) {
      return pluginPkg;
    }

    return {};
  });
  return _deepmerge.default.all([basePkg, ...pluginPkgs]);
};

exports.mergePackages = mergePackages;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9VdGlscy9tZXJnZS9pbmRleC50cyJdLCJuYW1lcyI6WyJnZXRQbHVnaW5GaWxlIiwicGx1Z2luUGF0aCIsInBsdWdpbk5hbWUiLCJmaWxlTmFtZSIsInBsdWdpbkZpbGUiLCJyZXF1aXJlIiwicGF0aCIsImpvaW4iLCJlIiwidW5kZWZpbmVkIiwiZ2V0U3RyaW5nRmlsZSIsInN0ciIsInJlYWRGaWxlIiwibWVyZ2VKU09ORmlsZXMiLCJiYXNlIiwicGx1Z2luc1BhdGgiLCJwbHVnaW5zIiwibWVyZ2VPcHRpb25zIiwiYmFzZUZpbGUiLCJwbHVnaW5GaWxlcyIsIm1hcCIsInBsdWdpbiIsImZpbGUiLCJtZXJnZSIsImFsbCIsIm1lcmdlUGx1Z2luRGF0YSIsImluY2x1ZGVzIiwicHVzaCIsIm5hbWUiLCJkZXNjcmlwdGlvbiIsInVybCIsIm1lcmdlQmFiZWwiLCJiYXNlQmFiZWwiLCJwbHVnaW5SY3MiLCJQcm9taXNlIiwicGFyc2VkIiwiSlNPTiIsInBhcnNlIiwibWVyZ2VkIiwidW5pcXVlUHJlc2V0cyIsInByZXNldHNTZXQiLCJTZXQiLCJwcmVzZXRzIiwiZm9yRWFjaCIsImVsIiwibWVyZ2VQYWNrYWdlcyIsImFuc3dlcnMiLCJiYXNlUGtnIiwicGx1Z2luUGtncyIsInBsdWdpblBrZyIsInBsdWdpblBrZ0ZuIiwiZm5Qa2ciLCJhcHBseSJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOzs7O0FBVUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNQSxhQUlxQixHQUFHLENBQUNDLFVBQUQsRUFBYUMsVUFBYixFQUF5QkMsUUFBekIsS0FBc0M7QUFDbEUsTUFBSTtBQUNGO0FBQ0EsVUFBTUMsVUFBVSxHQUFHQyxPQUFPLENBQUNDLGNBQUtDLElBQUwsQ0FDekJOLFVBRHlCLEVBRXpCLFNBRnlCLEVBR3pCQyxVQUh5QixFQUl6QkMsUUFKeUIsQ0FBRCxDQUExQjs7QUFPQSxX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RCxhQUFhLENBQy9CZSxXQUQrQixFQUUvQk0sTUFGK0IsRUFHL0IsWUFIK0IsQ0FBakM7O0FBTUEsUUFBSTZCLFdBQVcsSUFBSUQsU0FBbkIsRUFBOEI7QUFDNUIsWUFBTUUsS0FBSyxHQUFHRCxXQUFXLENBQUNFLEtBQVosQ0FBa0JILFNBQWxCLEVBQTZCSCxPQUE3QixDQUFkO0FBQ0EsYUFBT0ssS0FBUDtBQUNELEtBSEQsTUFHTyxJQUFJRixTQUFKLEVBQWU7QUFDcEIsYUFBT0EsU0FBUDtBQUNEOztBQUNELFdBQU8sRUFBUDtBQUNELEdBbkJrQixDQUFuQjtBQXFCQSxTQUFPMUIsbUJBQU1DLEdBQU4sQ0FBVSxDQUFDdUIsT0FBRCxFQUFVLEdBQUdDLFVBQWIsQ0FBVixDQUFQO0FBQ0QsQ0E3Qk0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbWVyZ2UgZnJvbSAnZGVlcG1lcmdlJ1xyXG5pbXBvcnQgeyByZWFkRmlsZSB9IGZyb20gJ2ZzJ1xyXG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJ1xyXG5pbXBvcnQgeyBwcm9taXNpZnkgfSBmcm9tICd1dGlsJ1xyXG5pbXBvcnQge1xyXG4gIEFzeW5jTWVyZ2VyRm4sXHJcbiAgTWVyZ2VyRm4sXHJcbiAgUGFja2FnZU1lcmdlckZuLFxyXG4gIFBrZ0ZuVHlwZSxcclxuICBQa2dUeXBlLFxyXG4gIFBsdWdpbkRhdGEsXHJcbn0gZnJvbSAnLi9tZXJnZSdcclxuXHJcbi8qKlxyXG4gKlxyXG4gKiBAcGFyYW0gcGx1Z2luUGF0aCBwYXRoIHRvIHRoZSBwbHVnaW4gcGFjayBkaXJlY3RvcnlcclxuICogQHBhcmFtIHBsdWdpbk5hbWUgbmFtZSBvZiB0aGUgcGx1Z2luIHRvIHRhcmdldFxyXG4gKiBAcGFyYW0gZmlsZU5hbWUgbmFtZSBvZiB0aGUgZmlsZSBpbnNpZGUgb2YgYSBwbHVnaW4gdG8gdGFyZ2V0XHJcbiAqIEByZXR1cm5zIHRoZSBmaWxlIGJlaW5nIHRhcmdldGVkIGluIHRoZSBzcGVjaWZpZWQgcGx1Z2luXHJcbiAqL1xyXG5jb25zdCBnZXRQbHVnaW5GaWxlOiA8UmV0dXJuVHlwZSBleHRlbmRzIGFueT4oXHJcbiAgcGx1Z2luUGF0aDogc3RyaW5nLFxyXG4gIHBsdWdpbk5hbWU6IHN0cmluZyxcclxuICBmaWxlTmFtZTogc3RyaW5nXHJcbikgPT4gUmV0dXJuVHlwZSB8IHVuZGVmaW5lZCA9IChwbHVnaW5QYXRoLCBwbHVnaW5OYW1lLCBmaWxlTmFtZSkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXZhci1yZXF1aXJlc1xyXG4gICAgY29uc3QgcGx1Z2luRmlsZSA9IHJlcXVpcmUocGF0aC5qb2luKFxyXG4gICAgICBwbHVnaW5QYXRoLFxyXG4gICAgICAncGx1Z2lucycsXHJcbiAgICAgIHBsdWdpbk5hbWUsXHJcbiAgICAgIGZpbGVOYW1lXHJcbiAgICApKVxyXG5cclxuICAgIHJldHVybiBwbHVnaW5GaWxlXHJcbiAgfSBjYXRjaCAoZSkge1xyXG4gICAgcmV0dXJuIHVuZGVmaW5lZFxyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIFN0cmluZ2lmeSB0aGUgY29udGVudHMgb2YgYSBmaWxlIGluc2lkZSBvZiB0aGUgcGx1Z2luIHByb3ZpZGVkXHJcbiAqXHJcbiAqIEBwYXJhbSBwbHVnaW5QYXRoIHBhdGggdG8gdGhlIHBsdWdpbiBwYWNrIGRpcmVjdG9yeVxyXG4gKiBAcGFyYW0gcGx1Z2luTmFtZSBuYW1lIG9mIHRoZSBwbHVnaW4gdG8gdGFyZ2V0XHJcbiAqIEBwYXJhbSBmaWxlTmFtZSBuYW1lIG9mIHRoZSBmaWxlIGluc2lkZSBvZiB0aGUgcGx1Z2luIHRvIHRhcmdldFxyXG4gKi9cclxuY29uc3QgZ2V0U3RyaW5nRmlsZSA9IGFzeW5jIChcclxuICBwbHVnaW5QYXRoOiBzdHJpbmcsXHJcbiAgcGx1Z2luTmFtZTogc3RyaW5nLFxyXG4gIGZpbGVOYW1lOiBzdHJpbmdcclxuKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN0ciA9IGF3YWl0IHByb21pc2lmeShyZWFkRmlsZSkoXHJcbiAgICAgIHBhdGguam9pbihwbHVnaW5QYXRoLCAncGx1Z2lucycsIHBsdWdpbk5hbWUsIGZpbGVOYW1lKSxcclxuICAgICAgJ3V0ZjgnXHJcbiAgICApXHJcbiAgICBpZiAodHlwZW9mIHN0ciA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgcmV0dXJuIHN0clxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuICd7fSdcclxuICAgIH1cclxuICB9IGNhdGNoIChlKSB7XHJcbiAgICByZXR1cm4gJ3t9J1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIENvbWJpbmUgSlNPTiBmaWxlcyBvZiB0aGUgc2FtZSB0eXBlIGludG8gb25lIGZpbGUgdXNpbmcgZGVlcE1lcmdlXHJcbiAqXHJcbiAqIEBwYXJhbSBiYXNlXHJcbiAqIEBwYXJhbSBwbHVnaW5zUGF0aFxyXG4gKiBAcGFyYW0gcGx1Z2luc1xyXG4gKiBAcGFyYW0gZmlsZU5hbWVcclxuICogQHBhcmFtIG1lcmdlT3B0aW9uc1xyXG4gKiBAcmV0dXJuc1xyXG4gKi9cclxuZXhwb3J0IGNvbnN0IG1lcmdlSlNPTkZpbGVzOiBNZXJnZXJGbiA9IChcclxuICBiYXNlID0ge30sXHJcbiAgcGx1Z2luc1BhdGgsXHJcbiAgcGx1Z2lucyxcclxuICBmaWxlTmFtZSxcclxuICBtZXJnZU9wdGlvbnNcclxuKSA9PiB7XHJcbiAgY29uc3QgYmFzZUZpbGUgPSB7IC4uLmJhc2UgfVxyXG4gIGNvbnN0IHBsdWdpbkZpbGVzID0gcGx1Z2lucy5tYXAoKHBsdWdpbikgPT4ge1xyXG4gICAgY29uc3QgZmlsZSA9IGdldFBsdWdpbkZpbGU8UGtnVHlwZT4ocGx1Z2luc1BhdGgsIHBsdWdpbiwgZmlsZU5hbWUpXHJcbiAgICByZXR1cm4gZmlsZSA/PyB7fVxyXG4gIH0pXHJcbiAgcmV0dXJuIG1lcmdlLmFsbChbYmFzZUZpbGUsIC4uLnBsdWdpbkZpbGVzXSwgbWVyZ2VPcHRpb25zKSBhcyBSZWNvcmQ8XHJcbiAgICBzdHJpbmcsXHJcbiAgICB1bmtub3duXHJcbiAgPlxyXG59XHJcblxyXG4vKipcclxuICogQ29tYmluZSBhbGwgcGx1Z2luIG1ldGEuanNvbiBkYXRhIGludG8gb25lIGRvY3VtZW50XHJcbiAqXHJcbiAqIEBwYXJhbSBiYXNlIGJhc2UgZGljdGlvbmFyeSBvZiBwbHVnaW5zXHJcbiAqIEBwYXJhbSBwbHVnaW5zUGF0aCBwYXRoIHRvIHRoZSBwbHVnaW4gcGFjayBkaXJlY3RvcnlcclxuICogQHBhcmFtIHBsdWdpbnMgYXJyYXkgb2YgYWxsIHNlbGVjdGVkIHBsdWdpbnNcclxuICogQHBhcmFtIGZpbGVOYW1lIHRhcmdldCBmaWxlIGZvciB0aGUgcGx1Z2luc1xyXG4gKi9cclxuZXhwb3J0IGNvbnN0IG1lcmdlUGx1Z2luRGF0YTogTWVyZ2VyRm4gPSAoXHJcbiAgYmFzZSA9IHt9LFxyXG4gIHBsdWdpbnNQYXRoLFxyXG4gIHBsdWdpbnMsXHJcbiAgZmlsZU5hbWVcclxuKSA9PiB7XHJcbiAgY29uc3QgYmFzZUZpbGUgPSB7IC4uLmJhc2UgfVxyXG4gIGJhc2VGaWxlLnBsdWdpbnMgPSBbXVxyXG4gIHBsdWdpbnMubWFwKChwbHVnaW4pID0+IHtcclxuICAgIGlmIChbJ25wbScsICd5YXJuJywgJ3JlYWN0JywgJ25leHRqcycsICdyZWZpbmUnXS5pbmNsdWRlcyhwbHVnaW4pKSByZXR1cm5cclxuICAgIGNvbnN0IGZpbGUgPSBnZXRQbHVnaW5GaWxlPFBrZ1R5cGU+KHBsdWdpbnNQYXRoLCBwbHVnaW4sIGZpbGVOYW1lKSA/PyB7fVxyXG5cclxuICAgIDsoYmFzZUZpbGUucGx1Z2lucyBhcyBQbHVnaW5EYXRhW10pLnB1c2goe1xyXG4gICAgICBuYW1lOiAoZmlsZS5uYW1lIGFzIHN0cmluZykgPz8gcGx1Z2luLFxyXG4gICAgICBkZXNjcmlwdGlvbjogKGZpbGUuZGVzY3JpcHRpb24gYXMgc3RyaW5nKSA/PyAnJyxcclxuICAgICAgdXJsOiAoZmlsZS51cmwgYXMgc3RyaW5nKSA/PyAnJyxcclxuICAgIH0pXHJcbiAgfSlcclxuICByZXR1cm4gYmFzZUZpbGVcclxufVxyXG5cclxuLyoqXHJcbiAqIGNvbWJpbmUgYWxsIC5iYWJlbHJjIGZpbGVzIHRvZ2V0aGVyIGludG8gb25lXHJcbiAqXHJcbiAqIEBwYXJhbSBiYXNlIGJhc2UgZGljdGlvbmFyeSBvZiBwbHVnaW5zXHJcbiAqIEBwYXJhbSBwbHVnaW5zUGF0aCBwYXRoIHRvIHRoZSBwbHVnaW4gcGFjayBkaXJlY3RvcnlcclxuICogQHBhcmFtIHBsdWdpbnMgYXJyYXkgb2YgYWxsIHNlbGVjdGVkIHBsdWdpbnNcclxuICovXHJcbmV4cG9ydCBjb25zdCBtZXJnZUJhYmVsOiBBc3luY01lcmdlckZuID0gYXN5bmMgKGJhc2UsIHBsdWdpbnNQYXRoLCBwbHVnaW5zKSA9PiB7XHJcbiAgY29uc3QgYmFzZUJhYmVsID0geyAuLi5iYXNlIH1cclxuXHJcbiAgY29uc3QgcGx1Z2luUmNzID0gYXdhaXQgUHJvbWlzZS5hbGwoXHJcbiAgICBwbHVnaW5zLm1hcChhc3luYyAocGx1Z2luKSA9PiB7XHJcbiAgICAgIGNvbnN0IHN0ciA9IGF3YWl0IGdldFN0cmluZ0ZpbGUocGx1Z2luc1BhdGgsIHBsdWdpbiwgJy5iYWJlbHJjJylcclxuICAgICAgY29uc3QgcGFyc2VkID0gSlNPTi5wYXJzZShzdHIpXHJcblxyXG4gICAgICByZXR1cm4gcGFyc2VkID8/IHt9XHJcbiAgICB9KVxyXG4gIClcclxuXHJcbiAgY29uc3QgbWVyZ2VkID0gbWVyZ2UuYWxsKFtiYXNlQmFiZWwsIC4uLnBsdWdpblJjc10pIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+XHJcblxyXG4gIGNvbnN0IHVuaXF1ZVByZXNldHM6IHN0cmluZ1tdID0gW11cclxuICBjb25zdCBwcmVzZXRzU2V0ID0gbmV3IFNldCgobWVyZ2VkLnByZXNldHMgYXMgc3RyaW5nW10pID8/IFtdKVxyXG4gIHByZXNldHNTZXQuZm9yRWFjaCgoZWwpID0+IHVuaXF1ZVByZXNldHMucHVzaChlbCkpXHJcbiAgbWVyZ2VkLnByZXNldHMgPSB1bmlxdWVQcmVzZXRzXHJcblxyXG4gIHJldHVybiBtZXJnZWRcclxufVxyXG5cclxuLyoqXHJcbiAqIG1lcmdlIHBhY2thZ2UuanNvbiBhbmQgcGFja2FnZS5qcyBmaWxlcyB0b2dldGhlclxyXG4gKlxyXG4gKiBAcGFyYW0gYmFzZSBhbGwgb2YgdGhlIGRhdGEgcHJvdmlkZWQgYnkgdGhlIHNhb0ZpbGUgZGF0YSBmdW5jdGlvblxyXG4gKiBAcGFyYW0gcGx1Z2luc1BhdGhcclxuICogQHBhcmFtIHBsdWdpbnNcclxuICogQHBhcmFtIGFuc3dlcnNcclxuICovXHJcbmV4cG9ydCBjb25zdCBtZXJnZVBhY2thZ2VzOiBQYWNrYWdlTWVyZ2VyRm4gPSAoXHJcbiAgYmFzZSA9IHt9LFxyXG4gIHBsdWdpbnNQYXRoLFxyXG4gIHBsdWdpbnMsXHJcbiAgYW5zd2Vyc1xyXG4pID0+IHtcclxuICBjb25zdCBiYXNlUGtnID0geyAuLi5iYXNlIH1cclxuICBjb25zdCBwbHVnaW5Qa2dzID0gcGx1Z2lucy5tYXAoKHBsdWdpbikgPT4ge1xyXG4gICAgY29uc3QgcGx1Z2luUGtnID0gZ2V0UGx1Z2luRmlsZTxQa2dUeXBlPihcclxuICAgICAgcGx1Z2luc1BhdGgsXHJcbiAgICAgIHBsdWdpbixcclxuICAgICAgJ3BhY2thZ2UuanNvbidcclxuICAgIClcclxuICAgIGNvbnN0IHBsdWdpblBrZ0ZuID0gZ2V0UGx1Z2luRmlsZTxQa2dGblR5cGU+KFxyXG4gICAgICBwbHVnaW5zUGF0aCxcclxuICAgICAgcGx1Z2luLFxyXG4gICAgICAncGFja2FnZS5qcydcclxuICAgIClcclxuXHJcbiAgICBpZiAocGx1Z2luUGtnRm4gJiYgcGx1Z2luUGtnKSB7XHJcbiAgICAgIGNvbnN0IGZuUGtnID0gcGx1Z2luUGtnRm4uYXBwbHkocGx1Z2luUGtnLCBhbnN3ZXJzKVxyXG4gICAgICByZXR1cm4gZm5Qa2dcclxuICAgIH0gZWxzZSBpZiAocGx1Z2luUGtnKSB7XHJcbiAgICAgIHJldHVybiBwbHVnaW5Qa2dcclxuICAgIH1cclxuICAgIHJldHVybiB7fVxyXG4gIH0pXHJcblxyXG4gIHJldHVybiBtZXJnZS5hbGwoW2Jhc2VQa2csIC4uLnBsdWdpblBrZ3NdKSBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPlxyXG59XHJcbiJdfQ==